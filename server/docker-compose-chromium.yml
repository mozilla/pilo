services:
  browserless:
    image: ghcr.io/browserless/chromium:latest
    container_name: spark-browserless
    ports:
      - "3001:3000" # Map browserless port to avoid conflict with spark server
    environment:
      - DEBUG=browserless*
      - MAX_CONCURRENT_SESSIONS=5
      - CONNECTION_TIMEOUT=60000
      - MAX_QUEUE_LENGTH=10

  spark:
    build:
      context: ..
      dockerfile: server/Dockerfile
    container_name: spark-server
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - SPARK_PW_ENDPOINT=ws://browserless:3000/playwright/chromium
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - SPARK_MODEL=gpt-5-mini
      - SPARK_REASONING_EFFORT=low
      - SPARK_BROWSER=chromium
    depends_on:
      - browserless

networks:
  default:
    name: spark-network
