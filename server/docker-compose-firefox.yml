services:
  spark:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: spark-server
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PW_ENDPOINT=ws://browserless:3000/playwright/firefox
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - BROWSER=firefox

  browserless:
    image: ghcr.io/browserless/firefox:latest
    container_name: spark-browserless
    ports:
      - "3001:3000" # Map browserless port to avoid conflict with spark server
    environment:
      - DEBUG=browserless*
      - MAX_CONCURRENT_SESSIONS=5
      - CONNECTION_TIMEOUT=60000
      - MAX_QUEUE_LENGTH=10

networks:
  default:
    name: spark-network
