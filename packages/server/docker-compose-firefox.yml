services:
  pilo:
    build:
      context: ..
      dockerfile: server/Dockerfile
    container_name: pilo-server
    ports:
      - "3000:3000"
    environment:
      - NODE_ENV=production
      - PILO_PW_ENDPOINT=ws://browserless:3000/playwright/firefox
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - PILO_MODEL=gpt-5-mini
      - PILO_REASONING_EFFORT=low
      - PILO_BROWSER=firefox

  browserless:
    image: ghcr.io/browserless/firefox:latest
    container_name: pilo-browserless
    ports:
      - "3001:3000" # Map browserless port to avoid conflict with pilo server
    environment:
      - DEBUG=browserless*
      - MAX_CONCURRENT_SESSIONS=5
      - CONNECTION_TIMEOUT=60000
      - MAX_QUEUE_LENGTH=10

networks:
  default:
    name: pilo-network
